// Generated by LiveScript 1.3.1
(function(){
  var CurrentSum, addHandlerOnControlRingButtons, addHandler, addHandlerOnInfoButton, addResetFunction, reset, addRobotButton;
  $(function(){
    var currentSum;
    currentSum = new CurrentSum;
    addHandlerOnControlRingButtons(currentSum);
    addHandlerOnInfoButton(currentSum);
    addResetFunction(currentSum);
    return addRobotButton(currentSum);
  });
  CurrentSum = function(){
    this.sum = 0;
  };
  addHandlerOnControlRingButtons = function(currentSum){
    var i$, ref$, len$, button;
    for (i$ = 0, len$ = (ref$ = $('.button')).length; i$ < len$; ++i$) {
      button = ref$[i$];
      $(button).addClass('unvisit');
      button.status = 'unclick';
      addHandler(button, currentSum);
      $(button).click(fn$);
    }
    function fn$(event){
      event.stopPropagation();
      $(this).trigger('handler');
    }
  };
  addHandler = function(button, currentSum){
    $(button).bind('handler', function(event){
      var this$ = this;
      event.stopPropagation();
      if (this.status === 'clicked' || $(this).hasClass('visited')) {
        return;
      }
      this.status = 'clicked';
      $(this).children('.unread').addClass("visiable").text('...');
      return $.get('/', function(data, status){
        var i$, ref$, len$, bt, flag;
        $(this$).children('.unread').text(data);
        currentSum.sum += parseInt(data);
        console.log(currentSum);
        for (i$ = 0, len$ = (ref$ = $('.button')).length; i$ < len$; ++i$) {
          bt = ref$[i$];
          if (bt.status === 'clicked') {
            $(bt).removeClass('unvisit').addClass('visited');
          } else {
            $(bt).removeClass('visited').addClass('unvisit');
          }
        }
        flag = true;
        for (i$ = 0, len$ = (ref$ = $('.button')).length; i$ < len$; ++i$) {
          bt = ref$[i$];
          if ($(bt).hasClass('unvisit')) {
            flag = false;
            break;
          }
        }
        if (flag === true) {
          $('#info').removeClass('visited').addClass('unvisit');
        }
        if (this$.next === undefined) {
          $('#info').trigger('handler');
        } else if (this$.next !== false) {
          $('li' + (":nth-child(" + this$.next + ")")).trigger('handler');
        }
      });
    });
  };
  addHandlerOnInfoButton = function(currentSum){
    var info;
    info = $('#info');
    info[0].status = 'unclick';
    info.addClass('visited');
    info.bind('handler', function(event){
      event.stopPropagation();
      if (this.status === 'clicked' || $(this).hasClass('visited')) {
        return;
      }
      this.status = 'clicked';
      return $(this).removeClass('unvisit').addClass('visited').text(currentSum.sum);
    });
    info.click(function(event){
      event.stopPropagation();
      return $(this).trigger('handler');
    });
  };
  addResetFunction = function(currentSum){
    $('#button').on('mouseleave', function(){
      console.log('setTimeout');
      setTimeout(reset(currentSum, 0));
    });
  };
  reset = function(currentSum){
    var i$, ref$, len$, bt;
    console.log('begin reset');
    for (i$ = 0, len$ = (ref$ = $('.button')).length; i$ < len$; ++i$) {
      bt = ref$[i$];
      bt.status = 'unclick';
      console.log(bt.next);
      bt.next = false;
      $(bt).removeClass('visited').addClass('unvisit');
      $(bt).children('.unread').removeClass('visiable');
    }
    $('#info').get(0).status = 'unclick';
    $('#info').removeClass('unvisit').addClass('visited').text(" ");
    currentSum.sum = 0;
    console.log(currentSum.sum);
  };
  addRobotButton = function(currentSum){
    $('#button').get(0).status = 'unclick';
    $('#button').bind('handler', function(event){
      var sequence, i$, i;
      event.stopPropagation();
      console.log('in button');
      if (this.status === 'clicked') {
        return;
      }
      this.status = 'unclick';
      sequence = [1, 2, 3, 4, 5];
      for (i$ = 0; i$ < 4; ++i$) {
        i = i$;
        $('li' + (":nth-child(" + sequence[i] + ")")).get(0).next = sequence[i + 1];
      }
      $('li' + (":nth-child(" + sequence[4] + ")")).get(0).next = undefined;
      currentSum.sum = 0;
      return $('li' + (":nth-child(" + sequence[0] + ")")).trigger('handler');
    });
    $('#button').click(function(event){
      event.stopPropagation();
      console.log('button click');
      $(this).trigger('handler');
    });
  };
}).call(this);
