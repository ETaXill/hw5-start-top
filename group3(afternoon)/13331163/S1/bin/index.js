// Generated by LiveScript 1.3.1
(function(){
  var CurrentSum, addHandlerOnControlRingButtons, addHandler, addHandlerOnInfoButton, addResetFunction, reset;
  $(function(){
    var currentSum;
    currentSum = new CurrentSum;
    addHandlerOnControlRingButtons(currentSum);
    addHandlerOnInfoButton(currentSum);
    return addResetFunction(currentSum);
  });
  CurrentSum = function(){
    this.sum = 0;
  };
  addHandlerOnControlRingButtons = function(currentSum){
    var i$, ref$, len$, button;
    for (i$ = 0, len$ = (ref$ = $('.button')).length; i$ < len$; ++i$) {
      button = ref$[i$];
      $(button).addClass('unvisit');
      button.status = 'unclick';
      addHandler(button, currentSum);
      $(button).click(fn$);
    }
    function fn$(){
      $(this).trigger('handler');
    }
  };
  addHandler = function(button, currentSum){
    $(button).bind('handler', function(){
      var i$, ref$, len$, bt, this$ = this;
      if (this.status === 'clicked' || $(this).hasClass('visited')) {
        return;
      }
      this.status = 'clicked';
      for (i$ = 0, len$ = (ref$ = $('.button')).length; i$ < len$; ++i$) {
        bt = ref$[i$];
        if (bt !== this) {
          $(bt).removeClass('unvisit').addClass('visited');
        }
      }
      $(this).children('.unread').addClass("visiable").text('...');
      return $.get('/', function(data, status){
        var i$, ref$, len$, bt, flag;
        $(this$).children('.unread').text(data);
        currentSum.sum += parseInt(data);
        for (i$ = 0, len$ = (ref$ = $('.button')).length; i$ < len$; ++i$) {
          bt = ref$[i$];
          if (bt.status === 'clicked') {
            $(bt).removeClass('unvisit').addClass('visited');
          } else {
            $(bt).removeClass('visited').addClass('unvisit');
          }
        }
        flag = true;
        for (i$ = 0, len$ = (ref$ = $('.button')).length; i$ < len$; ++i$) {
          bt = ref$[i$];
          if ($(bt).hasClass('unvisit')) {
            flag = false;
            break;
          }
        }
        if (flag === true) {
          $('#info').removeClass('visited').addClass('unvisit');
        }
      });
    });
  };
  addHandlerOnInfoButton = function(currentSum){
    var info;
    info = $('#info');
    info[0].status = 'unclick';
    info.addClass('visited');
    info.bind('handler', function(){
      if (this.status === 'clicked' || $(this).hasClass('visited')) {
        return;
      }
      this.status = 'clicked';
      return $(this).removeClass('unvisit').addClass('visited').text(currentSum.sum);
    });
    info.click(function(){
      $(this).trigger('handler');
    });
  };
  addResetFunction = function(currentSum){
    return $('#button').on('mouseleave', function(){
      return setTimeout(reset(currentSum, 0));
    });
  };
  reset = function(currentSum){
    var i$, ref$, len$, bt;
    for (i$ = 0, len$ = (ref$ = $('.button')).length; i$ < len$; ++i$) {
      bt = ref$[i$];
      bt.status = 'unclick';
      $(bt).removeClass('visited').addClass('unvisit');
      $(bt).children('.unread').removeClass('visiable');
    }
    $('#info').get(0).status = 'unclick';
    $('#info').removeClass('unvisit').addClass('visited').text(" ");
    currentSum.sum = 0;
  };
  $.ajaxSetup({
    cache: false
  });
}).call(this);
