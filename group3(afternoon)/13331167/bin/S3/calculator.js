// Generated by LiveScript 1.3.1
(function(){
  $(function(){
    var bubbles, bar, button, icon, clickOnBubble, showNumber, changeState, allNumberGot, addUp, init, parallelClick, robot;
    bubbles = $('#control-ring li');
    bar = $('#info-bar');
    button = $('#button');
    icon = $('#icon');
    clickOnBubble = function(certainBubble){
      var little_red_circle, i$, ref$, len$, x;
      certainBubble.state = 'clicked';
      little_red_circle = $(certainBubble).children('div');
      little_red_circle.css('display', 'block').html('...');
      for (i$ = 0, len$ = (ref$ = bubbles).length; i$ < len$; ++i$) {
        x = ref$[i$];
        if (x !== certainBubble && x.state === 'unclicked') {
          $(x).removeClass('enable').addClass('disable');
        }
      }
    };
    showNumber = function(certainBubble, number){
      var little_red_circle;
      little_red_circle = $(certainBubble).children('div');
      little_red_circle.html(number);
      $(certainBubble).removeClass('enable').addClass('disable');
    };
    changeState = function(){
      var i$, ref$, len$, x;
      for (i$ = 0, len$ = (ref$ = bubbles).length; i$ < len$; ++i$) {
        x = ref$[i$];
        if (x.state === 'unclicked') {
          $(x).removeClass('disable').addClass('enable');
        }
      }
    };
    allNumberGot = function(){
      var i$, ref$, len$, x, little_red_circle;
      for (i$ = 0, len$ = (ref$ = bubbles).length; i$ < len$; ++i$) {
        x = ref$[i$];
        little_red_circle = $(x).children('div');
        if (x.state === 'unclicked' || little_red_circle.html === '...') {
          return;
        }
      }
      bar.removeClass('disable').addClass('enable');
    };
    addUp = function(){
      var sum, i$, ref$, len$, x;
      if (bar.hasClass('enable')) {
        sum = 0;
        for (i$ = 0, len$ = (ref$ = bubbles).length; i$ < len$; ++i$) {
          x = ref$[i$];
          sum += parseInt($(x).children('div').html());
        }
        bar.children().html(sum);
        bar.removeClass('enable').addClass('disable');
      }
    };
    (init = function(){
      var i$, ref$, len$, x, little_red_circle;
      for (i$ = 0, len$ = (ref$ = bubbles).length; i$ < len$; ++i$) {
        x = ref$[i$];
        x.state = 'unclicked';
        $(x).removeClass('disable').addClass('enable');
        little_red_circle = $(x).children('div');
        little_red_circle.css('display', 'none');
        bar.children().html('');
      }
      bar.removeClass('enable').addClass('disable');
      icon.addClass('unclicked');
    })();
    bubbles.click(function(){
      var this$ = this;
      if ($(this).hasClass('enable') && this.state === 'unclicked') {
        clickOnBubble(this);
        $.get('/', function(number){
          if (this$.state === 'unclicked' || $(this$).hasClass('disable')) {
            return;
          }
          showNumber(this$, number);
          changeState();
          allNumberGot();
        });
      }
    });
    bar.click(function(){
      addUp();
    });
    button.mouseleave(function(){
      init();
    });
    parallelClick = function(certainBubble){
      var count, this$ = this;
      count = 0;
      $(certainBubble).removeClass('enable').addClass('disable');
      clickOnBubble(certainBubble);
      $.get('/?randnum=' + Math.random(), function(number){
        showNumber(certainBubble, number);
        changeState();
        allNumberGot();
        addUp();
      });
    };
    robot = function(){
      var i$, ref$, len$, x;
      for (i$ = 0, len$ = (ref$ = bubbles).length; i$ < len$; ++i$) {
        x = ref$[i$];
        parallelClick(x);
      }
    };
    icon.click(function(){
      if (!icon.hasClass('unclicked')) {
        return;
      }
      init();
      icon.removeClass('unclicked');
      robot();
    });
  });
}).call(this);
